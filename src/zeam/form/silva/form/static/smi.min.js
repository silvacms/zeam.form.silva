(function(e,t){var n=function(){var t=e(this);if(t.hasClass("form-novalidation"))return;if(t.closest(".field-object").length)return;var n=t.closest("form"),r=t.attr("data-field-prefix"),i=n.attr("name"),s=n.attr("data-form-url");if(!s)return;var o=function(e){return t.is(e)?t.children("div.form-field"):t.find(e).children("div.form-field")};t.delegate(".field","change",function(){setTimeout(function(){var n=[{name:"prefix.field",value:r},{name:"prefix.form",value:i}],u=function(){var t=e(this);if((t.is(":checkbox")||t.is(":radio"))&&!t.is(":checked"))return;var r=t.val();if(r===null)return;e.isArray(r)||(r=[r]);for(var i=r.length;i>0;i--)n.push({name:t.attr("name"),value:r[i-1]})};t.find("input").each(u),t.find("textarea").each(u),t.find("select").each(u),e.ajax({url:s+"/++rest++zeam.form.silva.validate",type:"POST",dataType:"json",data:n,success:function(e){var n,r=e.errors;t.find(".form-error-message").remove();if(e.success){t.removeClass("form-error");return}t.addClass("form-error");if(r)for(n in r)o('div[data-field-prefix="'+n+'"]').after('<div class="form-error-message"><div class="form-error-detail"><p>'+r[n]+"</p></div></div>")}})},0)})};e(document).bind("load-smiplugins",function(n,r){var i=function(n,i){var s={},o=e.Deferred(),u=!1,a=null,f=function(){a!==null&&(a.trigger("clean-smiform",{form:a,container:a,popup:n}),a.remove(),a=null)},l=function(o,u){var f=u.label,l=u.name,c=u.action;return function(){switch(c){case"send":case"close_on_success":a.trigger("serialize-smiform",{form:a,container:a,popup:n});var u=a.serializeArray();u.push({name:l,value:f}),i!==undefined&&(u=u.concat(i)),r.ajax.query(o,u).pipe(function(i){return t.interfaces.is_implemented_by("popup",i)?c=="close_on_success"&&i.success?s.close(i):e.when(s.from_data(i)).pipe(function(e){return t.ui.ResizeDialog(n),e}):s.close(i).done(function(t){return e(document).render({data:t,args:[r]})})},function(e){s.close({})});break;case"close":s.close({})}return!1}};return n.dialog({autoOpen:!1,modal:!0,width:800}),n.bind("dialogclose",function(){f(),n.remove(),u===!1&&o.reject({})}),n.delegate("a.open-screen","click",function(e){n.dialog("close")}),e.extend(s,{display:function(r){return e.when(r).pipe(function(e){return t.ui.ShowDialog(n,{maxFactor:.8}),s},function(t){return e.Deferred().reject(t)})},close:function(e){return u=!0,n.dialog("close"),o.resolve(e)},promise:function(){return o.promise()},from_url:function(e){return r.ajax.query(e).pipe(function(e){return t.interfaces.is_implemented_by("popup",e)?s.from_data(e):s.close(e)},function(e){return u=!0,n.dialog("close"),o.reject(e)})},from_data:function(t){var r={},i=t.submit_url||t.url;f(),a=e('<form class="form-content form-fields-container" />'),a.attr("data-form-url",t.url),t.validation||a.attr("data-form-novalidation","true"),a.attr("name",t.prefix),a.html(t.widgets),a.append('<input type="submit" style="display: none" />'),n.dialog("option","title",t.label),n.append(a);for(var s=0;s<t.actions.length;s++){var o=t.actions[s].label,u=l(i,t.actions[s]);r[o]=u,t["actions"][s]["name"]==t["default"]&&a.bind("submit",u)}return n.dialog("option","buttons",r),a.trigger("load-smiform",{form:a,container:a,popup:n}),a}}),s};e.fn.SMIFormPopup=function(n){var r=e("<div></div>"),s=undefined;n=e.extend(n,{}),n.url!==undefined?s=n.url:s=e(this).attr("href");var o=i(r,n.payload),u=null;return t.interfaces.is_implemented_by("popup",n)?u=o.from_data(n):u=o.from_url(s),o.display(u)},t.views.view({iface:"popup",factory:function(e,t){return e.SMIFormPopup(t)}})}),e(".field-collection-line").live("addline-zeamform",function(){var t=e(this);t.addClass("form-fields-container"),t.trigger("loadwidget-smiform")}),e(".form-fields-container").live("loadwidget-smiform",function(t){e(this).find("div.field-collection").each(function(){e(this).ZeamCollectionWidget!==undefined&&e(this).ZeamCollectionWidget()}),t.stopPropagation()});var r=function(){var t=e(this);t.find(".zeam-select-all").bind("change",function(){var n=e(this),r=n.attr("checked");t.find("."+n.attr("name")).each(function(){r?e(this).attr("checked",r):e(this).removeAttr("checked")})}),t.find("form").each(function(){var t=e(this);t.data("form-novalidation")||t.find(".form-section").each(n)})};e(".form-content").live("load-smiform",r),e(document).ready(function(){e(".form-content").each(r),e(".form-popup").live("click",function(){return e(this).SMIFormPopup(),!1})})})(jQuery,infrae);